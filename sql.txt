
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- 1. Table: requests
create table if not exists requests (
  "id" text primary key,
  "invoiceNumber" text,
  "clientName" text,
  "origin" text,
  "destination" text,
  "vehicleType" text,
  "distanceKm" float,
  "driverFee" float,
  "clientCharge" float,
  "status" text,
  "createdAt" text,
  "driverId" text,
  "scheduledFor" text,
  "activityType" text,
  "contactOnSite" text,
  "observations" text,
  "waypoints" jsonb,
  "commissionedName" text,
  "commissionPercentage" float
);

-- 2. Table: drivers
create table if not exists drivers (
  "id" text primary key,
  "name" text,
  "cpf" text,
  "address" text,
  "vehicleType" text,
  "phone" text,
  "createdAt" text,
  "plate" text,
  "model" text,
  "color" text
);

-- 3. Table: clients
create table if not exists clients (
  "id" text primary key,
  "name" text,
  "cnpj" text,
  "address" text,
  "costCenter" text,
  "contactName" text,
  "contactPhone" text,
  "contactEmail" text,
  "paymentDay" int,
  "createdAt" text
);

-- 4. Table: expenses
create table if not exists expenses (
  "id" text primary key,
  "driverId" text,
  "type" text,
  "amount" float,
  "date" text,
  "description" text
);

-- 5. Table: rates
create table if not exists rates (
  "type" text primary key,
  "label" text,
  "costPerKm" float,
  "chargePerKm" float,
  "baseFee" float
);

-- 6. Table: users
create table if not exists users (
  "id" text primary key,
  "username" text unique,
  "password" text,
  "role" text,
  "clientId" text,
  "name" text,
  "mustChangePassword" boolean default false
);

-- 7. Table: contracts
create table if not exists contracts (
  "id" text primary key,
  "clientName" text,
  "contractValue" float,
  "invoiceDay" int,
  "createdAt" text,
  "staff" jsonb -- Almacena el array de StaffExpense con los nuevos campos
);

-- 8. Migrations (Safely add columns)
do $$
begin
  if not exists (select 1 from information_schema.tables where table_name='contracts') then
     create table contracts (
        "id" text primary key,
        "clientName" text,
        "contractValue" float,
        "invoiceDay" int,
        "createdAt" text,
        "staff" jsonb
     );
  end if;
end
$$;

-- 9. Default Seeds
insert into rates ("type", "label", "costPerKm", "chargePerKm", "baseFee")
values 
  ('MOTO', 'Motoboy', 1.50, 2.50, 5.00),
  ('CARRO', 'Carro', 2.50, 4.00, 8.00),
  ('UTILITARIO', 'Utilitário', 4.00, 6.50, 15.00),
  ('CAMINHAO', 'Caminhão', 8.00, 12.00, 50.00),
  ('PRESSKIT', 'Press Kit', 2.50, 4.50, 12.00)
on conflict ("type") do nothing;

insert into users ("id", "username", "password", "role", "name", "mustChangePassword")
values 
  ('1', 'admin', 'admin', 'ADMIN', 'Administrador', false),
  ('2', 'operacional', '123', 'OPERATIONAL', 'Operador Logístico', false),
  ('4', 'edna', '123', 'ADMIN', 'Edna (Admin)', true)
on conflict ("id") do nothing;
