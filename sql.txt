
-- LIMPEZA DEFINITIVA DO BANCO DE DADOS
-- ATENÇÃO: Execute este script para apagar todos os registros e começar do zero.

-- 1. Limpar tabelas de movimentação
truncate table requests cascade;
truncate table expenses cascade;
truncate table transactions cascade;
truncate table contracts cascade;
truncate table clients cascade;
truncate table drivers cascade;
truncate table users cascade;

-- 2. Garantir que as tabelas existam (caso tenham sido deletadas)
create table if not exists requests (
  "id" text primary key, "invoiceNumber" text, "clientName" text, "origin" text, "destination" text, "vehicleType" text,
  "distanceKm" float, "driverFee" float, "clientCharge" float, "status" text, "createdAt" text, "driverId" text,
  "scheduledFor" text, "activityType" text, "contactOnSite" text, "observations" text, "waypoints" jsonb,
  "commissionedName" text, "commissionPercentage" float
);

create table if not exists drivers (
  "id" text primary key, "name" text, "cpf" text, "address" text, "vehicleType" text, "phone" text, "createdAt" text,
  "plate" text, "model" text, "color" text
);

create table if not exists clients (
  "id" text primary key, "name" text, "cnpj" text, "address" text, "costCenter" text, "contactName" text,
  "contactPhone" text, "contactEmail" text, "paymentDay" int, "createdAt" text
);

create table if not exists expenses (
  "id" text primary key, "driverId" text, "type" text, "amount" float, "date" text, "description" text
);

create table if not exists rates (
  "type" text primary key, "label" text, "costPerKm" float, "chargePerKm" float, "baseFee" float
);

create table if not exists users (
  "id" text primary key, "username" text unique, "password" text, "role" text, "clientId" text, "name" text,
  "mustChangePassword" boolean default false
);

create table if not exists contracts (
  "id" text primary key, "clientName" text, "contractValue" float, "invoiceDay" int, "createdAt" text, "staff" jsonb
);

create table if not exists transactions (
  "id" text primary key, "date" text, "type" text, "category" text, "description" text, "value" float, "status" text,
  "paymentMethod" text, "createdAt" text
);

-- 3. Inserir dados de SISTEMA (Preços e Usuário Admin)
insert into rates ("type", "label", "costPerKm", "chargePerKm", "baseFee")
values 
  ('MOTO', 'Motoboy', 1.50, 2.50, 5.00),
  ('CARRO', 'Carro', 2.50, 4.00, 8.00),
  ('UTILITARIO', 'Utilitário', 4.00, 6.50, 15.00),
  ('CAMINHAO', 'Caminhão', 8.00, 12.00, 50.00),
  ('PRESSKIT', 'Press Kit', 2.50, 4.50, 12.00)
on conflict ("type") do nothing;

-- Inserimos apenas o admin principal
insert into users ("id", "username", "password", "role", "name", "mustChangePassword")
values 
  ('1', 'admin', 'admin', 'ADMIN', 'Administrador Principal', false)
on conflict ("id") do nothing;
